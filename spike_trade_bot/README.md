# 🎯 插针交易机器人（Spike Trade Bot）

## 📖 项目介绍

这是一个**完整的插针反弹交易策略系统**，基于插针检测逻辑设计，包含：
- ✅ 插针信号检测（复用 spike_signal_bot 逻辑）
- ✅ 完整交易策略（入场、止损、止盈、时间止损）
- ✅ 多币种回测引擎
- ✅ 参数优化工具
- ✅ 可视化分析
- ✅ 详细文档

---

## 🚀 快速开始（3分钟）

### 方式1：一键启动菜单（推荐）

```bash
cd /Users/wang/PythonProjects/coin-cta/spike_trade_bot/

./run_spike_strategy.sh
```

然后选择 `1 - 快速测试`

### 方式2：直接运行

```bash
python spike_strategy_quick_test.py
# 选择 1 进行快速回测
```

---

## 📁 文件说明

```
spike_trade_bot/
├── 🔧 核心程序（5个文件）
│   ├── spike_strategy_config.py          # ⚙️  配置中心（所有参数）
│   ├── spike_strategy_backtest.py        # 🚀 完整回测引擎
│   ├── spike_strategy_quick_test.py      # 🧪 快速测试工具
│   ├── spike_strategy_optimizer.py       # 🔧 参数优化工具
│   └── spike_strategy_visualize.py       # 📊 可视化分析
│
├── 📖 文档（4个文件）
│   ├── README.md                         # 📋 本文档（项目总览）
│   ├── START_HERE.md                     # 🚀 新手快速开始
│   ├── SPIKE_STRATEGY_GUIDE.md           # 📘 使用指南（调参、排错）
│   ├── spike_strategy_README.md          # 📖 策略详解（原理、优化）
│   └── 插针策略设计总结.md                # 📊 完整设计文档
│
├── 🎮 启动脚本
│   └── run_spike_strategy.sh             # 🎯 一键启动菜单
│
└── 📊 回测结果（自动生成）
    └── backtest_results/
        ├── *.csv                         # 交易明细
        └── plots_*/                      # 图表目录
```

---

## ⚙️ 配置数据路径

在运行之前，请先配置数据路径！

编辑 `spike_strategy_config.py`：

```python
# 修改为你的实际数据路径
data_path = Path(r'/Users/wang/PythonProjects/xingda/data/coin-binance-swap-candle-csv-1h-2025-11-12/')
```

如果数据在其他位置，请相应修改路径。

---

## 📊 策略概述

### 核心逻辑

**插针 = 市场极端情绪释放 → 大概率反弹/回落**

1. **下插针（做多）**
   ```
   特征：长下影线 + 大振幅 + 放量
   逻辑：恐慌抛售后快速买回 → 下方有强支撑
   操作：插针收盘后，下一根K线开多
   ```

2. **上插针（做空）**
   ```
   特征：长上影线 + 大振幅 + 放量
   逻辑：贪婪买入后快速卖出 → 上方有强阻力
   操作：插针收盘后，下一根K线开空
   ```

### 插针检测标准

```python
影线 >= 2.0 × 实体       # 主导影线明显
振幅 >= 2.0 × ATR(14)    # 波动足够大
成交量 >= 2.0 × 中位数    # 放量确认
```

### 风险管理

```python
止损：插针极值点（最低点/最高点）
止盈：2倍止损距离（盈亏比 2:1）
时间止损：24小时强制平仓
仓位：固定风险法（每笔风险2%）
```

---

## 🎮 使用流程

### 第1步：快速测试（验证逻辑）

```bash
python spike_strategy_quick_test.py
```

测试 5 个主流币种（BTC、ETH、SOL、DOGE、BNB），验证代码能跑。

**预期结果**：看到交易记录和回测报告 ✅

**如果没有信号**：降低过滤条件（见下方"调参指南"）

---

### 第2步：参数优化（找最优参数）

```bash
python spike_strategy_optimizer.py
```

自动测试多种参数组合（10-20分钟）。

**输出**：
- 最优参数显示在终端
- CSV文件保存在 `backtest_results/`

**下一步**：将最优参数更新到 `spike_strategy_config.py`

---

### 第3步：完整回测（所有币种）

```bash
python spike_strategy_backtest.py
```

回测所有币种（5-30分钟，取决于币种数量）。

**输出**：
- 终端显示完整回测报告
- 交易明细保存为 CSV

---

### 第4步：可视化分析

```bash
python spike_strategy_visualize.py backtest_results/插针反弹策略_V1.0_XXXXXXXX.csv
```

**生成5张图表**：
1. 📈 权益曲线
2. 💰 盈亏分布
3. 🎯 多空胜率对比
4. 🚪 平仓原因分布
5. 🏆 最佳币种排名

---

## ⚙️ 快速调参指南

所有参数在 `spike_strategy_config.py` 中修改。

### 🔴 问题1：没有交易信号

**解决**：降低过滤条件

```python
ATR_MULTIPLIER = 1.5         # 从 2.0 → 1.5
VOLUME_MULTIPLIER = 1.5      # 从 2.0 → 1.5
SHADOW_RATIO = 1.5           # 从 2.0 → 1.5
```

### 🟠 问题2：胜率太低（< 30%）

**解决**：降低盈亏比

```python
RISK_REWARD_RATIO = 1.5      # 从 2.0 → 1.5（更容易止盈）
```

### 🟡 问题3：最大回撤太大

**解决**：降低风险

```python
RISK_PER_TRADE = 0.01        # 从 2% → 1%
MAX_POSITION_SIZE = 0.2      # 从 30% → 20%
```

### 🟢 问题4：想提高收益

**方法1**：提高盈亏比
```python
RISK_REWARD_RATIO = 2.5      # 从 2.0 → 2.5
```

**方法2**：只做表现更好的方向
```python
TRADE_DIRECTION = "long_only"   # 或 "short_only"
```

---

## 📊 如何评价回测结果

### ✅ 优秀策略标准

```
年化ROI > 30%        # 收益率
最大回撤 < 15%        # 风险控制
夏普比率 > 1.5       # 风险调整后收益
盈亏比 > 2.0         # 平均盈利/平均亏损
胜率 > 35%           # 胜率不需要太高
交易次数 > 50        # 样本量充足
```

### ⚠️ 需要优化的信号

```
ROI < 10%            → 提高盈亏比或优化过滤
最大回撤 > 25%        → 降低单笔风险
夏普比率 < 1.0       → 优化止损止盈
盈亏比 < 1.5         → 提高盈亏比
胜率 < 25%           → 降低盈亏比或加趋势过滤
```

---

## 🧪 推荐测试流程

```
第1天：快速测试（验证逻辑）
  ↓
第2天：参数优化（找最优参数）
  ↓
第3天：完整回测 + 可视化
  ↓
第4-7天：样本内外验证（防止过拟合）
  ↓
第2-4周：小资金实盘（1000-5000U）
  ↓
1-2个月后：稳定盈利再加大资金
```

---

## 🐛 常见问题

### Q1: ModuleNotFoundError

**解决**：
```bash
pip install pandas numpy matplotlib
```

### Q2: 数据路径不存在

**解决**：编辑 `spike_strategy_config.py`，修改 `data_path` 变量

### Q3: 回测太慢

**解决**：
1. 先用快速测试（只测5个币种）
2. 缩短回测时间范围（只测2024年）
3. 减少优化参数组合数量

---

## 📖 文档导航

| 文档 | 适合人群 | 阅读时间 |
|-----|---------|---------|
| **START_HERE.md** | 新手，刚开始 | 10分钟 |
| **SPIKE_STRATEGY_GUIDE.md** | 遇到问题时 | 20分钟 |
| **spike_strategy_README.md** | 想深入了解 | 1小时 |
| **插针策略设计总结.md** | 研究设计思路 | 1-2小时 |

---

## ⚠️ 风险提示

### 策略特点

✅ **优势**：
- 信号清晰，逻辑简单
- 止损明确，风险可控
- 盈亏比高，小赔大赚

⚠️ **风险**：
- 胜率偏低（30-45%）
- 假突破风险
- 趋势市表现差
- 需要严格执行

### 重要原则

1. **单笔风险 ≤ 2%**（新手建议1%）
2. **严格止损**（不抗单、不幻想）
3. **小资金验证**（1000-5000U测试1-2月）
4. **心理建设**（接受连续亏损是正常的）

---

## 💡 最后的话

> **记住三件事：**
> 1. 活下来比赚快钱更重要
> 2. 回测表现 ≠ 实盘表现
> 3. 严格执行 > 完美策略

**祝交易顺利，稳定盈利！** 🚀💰

---

## 📞 相关项目

- **spike_signal_bot**：插针信号监控机器人
- **spike_backtest.py**：基础回测脚本
- **macd_signal_bot**：MACD信号机器人

---

**最后更新**：2025-11-21  
**版本**：V1.0  
**作者**：AI量化策略分析师


