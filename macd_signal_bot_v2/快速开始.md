# 快速开始指南

## 🚀 一键启动

### 方法1：调试模式（推荐首次使用）

```bash
cd /Users/wang/PythonProjects/coin-cta/macd_signal_bot_v2
./run_debug.sh
```

### 方法2：正常模式

```bash
cd /Users/wang/PythonProjects/coin-cta/macd_signal_bot_v2
source /Users/wang/PythonProjects/.venv/bin/activate
python macd_signal_bot_v2.py
```

## 📋 启动后会看到什么

```
✅ 使用代理: http://127.0.0.1:7890
正在连接交易所 binanceusdm... (尝试 1/3)
成功连接到 binanceusdm

🚀 MACD多周期共振监控系统 V2 启动
📊 监控 16 个交易对
⏰ 触发周期: 1h (反转检测)
🔄 共振周期: 15m, 5m, 3m
📈 MACD参数: (12, 26, 9)
⏱️  轮询策略: 在3分钟K线收盘后检测（智能等待）
📌 检测策略: 使用已收盘的K线（倒数第2根）
🚫 去重窗口: 3 分钟
💾 状态文件: /Users/wang/PythonProjects/coin-cta/macd_signal_bot_v2/.macd_state_v2.json
🐛 调试模式: 启用

开始监控... (按 Ctrl+C 停止)

⚠️  注意：只有当1h反转且所有共振周期同时满足条件时才会发送告警

💡 优势：使用已收盘K线，避免实时数据波动，信号更稳定可靠
```

## 🎯 核心改进

### 问题：之前为什么信号不准？

**场景**：
- 15:16 收到信号：3m 向上 ✅
- 15:35 看图表：3m 向下 ❌

**原因**：使用了正在形成的K线，数据会变！

### 解决：现在用已收盘的K线

```
修改前：使用最后一根K线（实时数据）
修改后：使用倒数第2根K线（已收盘）

结果：数据固定不变，信号可靠！
```

## 📊 收到信号示例

### 正常模式

```
[MACD共振] GRASS/USDT 🔴 向上反转
时间：2025-11-26 15:22:54

触发：1h 反转向上反转
共振：15m ✓ / 5m ✓ / 3m ✓

1h:  hist= -0.001200 (Δ=  0.000135)
15m: hist= -0.000137 (Δ=  0.000127)
 5m: hist=  0.000214 (Δ=  0.000078)
 3m: hist=  0.000293 (Δ=  0.000011)
```

### 调试模式（详细信息）

```
============================================================
🔍 开始检查 GRASS/USDT - 2025-11-26 15:30:02
============================================================

📊 检查1h反转:
  [1h] 当前K线(已收盘): 2025-11-26 14:00:00, hist=-0.00133477
  [1h] 前一K线(已收盘): 2025-11-26 13:00:00, hist=-0.00117416
  [1h] Δhist=0.00010275, 方向=向上
  ✅ [1h] 检测到向上反转！

🔍 检查共振周期（期望方向: up）:
  [15m] 当前K线(已收盘): 2025-11-26 15:15:00, hist=-0.00020600
  ✅ [15m] 共振成功！方向=up
  [5m] 当前K线(已收盘): 2025-11-26 15:20:00, hist=0.00019699
  ✅ [5m] 共振成功！方向=up
  [3m] 当前K线(已收盘): 2025-11-26 15:24:00, hist=0.00026257
  ✅ [3m] 共振成功！方向=up

✅ 信号检测成功！方向: up
```

## 🔧 配置选项

### 启用/禁用代理

```bash
# 启用代理（默认已启用）
export MACD_USE_PROXY=true
export MACD_PROXY_URL=http://127.0.0.1:7890

# 禁用代理
export MACD_USE_PROXY=false
```

### 修改企业微信 Webhook

编辑 `macd_signal_bot_v2.py` 第95行：

```python
WECHAT_WEBHOOK_URL = os.getenv("MACD_WECHAT_WEBHOOK_URL", "你的webhook地址")
```

### 修改监控币种

编辑 `macd_signal_bot_v2.py` 第58-75行：

```python
SYMBOLS = [
    "BTC/USDT",
    "ETH/USDT",
    # 添加或删除币种
]
```

## ⏱️ 轮询时间说明

程序会在每个3分钟K线收盘后30秒检测：

```
K线收盘: 15:00, 15:03, 15:06, 15:09, 15:12, 15:15, 15:18, ...
检测时间: 15:00:30, 15:03:30, 15:06:30, 15:09:30, 15:12:30, ...
```

**为什么加30秒？**
- K线在整点收盘
- 交易所需要时间处理数据
- 加30秒确保数据已完全更新

## 🛑 停止程序

按 `Ctrl+C` 停止：

```
^C

🛑 收到停止信号，正在保存状态...
✅ 状态已保存，程序退出
```

## ❓ 常见问题

### Q: 信号有延迟吗？

A: 有轻微延迟（30-40秒）：
- K线在整点收盘（如15:15:00）
- 程序在收盘后30秒检测（15:15:30）
- 加上处理时间约10秒
- 总延迟约40秒

注意：我们检测的是"已收盘的K线"，而不是"正在形成的K线"。

### Q: 如何验证信号准确性？

A: 
1. 启用调试模式
2. 查看日志中的K线时间戳
3. 在图表上找到对应的已收盘K线
4. 验证MACD柱的方向

### Q: 信号太少怎么办？

A: 这是正常的。系统要求：
- 1h 必须反转
- 15m/5m/3m 必须同向
- 条件严格，但信号质量高

### Q: 可以改回实时K线吗？

A: 不推荐。实时K线会导致：
- 数据不稳定
- 信号不一致
- 误报率高

## 📚 更多文档

- [README.md](README.md) - 完整使用说明
- [升级说明.md](升级说明.md) - 核心改进说明
- [CHANGELOG.md](CHANGELOG.md) - 详细技术变更

## 🎉 开始使用

现在就运行调试模式，看看效果吧：

```bash
cd /Users/wang/PythonProjects/coin-cta/macd_signal_bot_v2
./run_debug.sh
```

等待下一个3分钟K线收盘后，您就能看到详细的检测过程了！

